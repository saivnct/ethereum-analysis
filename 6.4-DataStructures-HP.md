# **Data Structure And Encoding - Compact encoding or Hex-prefix (HP)**

- https://medium.com/@phansnt/data-structure-in-ethereum-episode-1-compact-hex-prefix-encoding-12558ae02791

## **Hex-prefix (HP)**

- Think of Hex Prefix as an encoding/decoding mechanism of the **Path** to a given **Value** in the Ethereum network.

  => in Plain English - it means that _"I know a way to get to this house and here is the way of storing the map to the house"_

## **1. Some terminologies**

- Let’s play a game. Giving a map:
  > **Root**: {1: 'Dog', 2: B, 3: A}
  > <br>**A**: {1: C, 2: D, 3: 'Cat'}
  > <br>**B**: {1: 'Goat', 2: 'Bear', 3: 'Rat'}
  > <br>**C**: {1: 'Eagle', 2: 'Parrot', 3: E}
  > <br>**D**: {1: 'Shark', 2: 'Dolphin', 3: 'Whale'}
  > <br>**E**: {1: 'Duck', 2: 'Chicken', 3: 'Pig'}
- And a path:
  > 3–2–3
- Find the animal which the path is implying? => Result: **'Whale'**
- Let’s try another path:
  > 3–1–3–2
- Result: **'Chicken'**

### **By this game we get familiar with some terminologies**:

- **Key**: Root, A, B, C, D and E
- **Node**: the content corresponding with the key in the right part of each row.

  - Ex:
    > **key**: Root - **node**: {1: ‘Dog’, 2: B, 3: A}.

- **Path**: a routing from Root. Ex: 2–2–3.
- **Value**: there're some elements in all nodes, every element is a key-value pair => **Value** is the right part of element.
  - Value can be a **key** or **a name of animal**.
  - Ex: node {1: ‘Dog’, 2: B, 3: A} => the values are ‘Dog’, B, A
- **Nibble**: is a hex form of 4 bits. For example: 0x1, 0x4, 0xf …

## **2. Differentiate RLD from HP**

- RLP is used for encoding/decoding **Value**
- HP is used for encoding/decoding **Path**

## **3. HP encoding goals**

- [(Merkle Patricia Tries (MPT)](/6.5-DataStructures-Merkle-Patricia-Tries.md)) has 4 types of Node :
  - empty nodes
    - a blank node (NULL)
  - branch nodes
    - any node with 1 or more branches
    - branch node can have leaf node and extension node in branch
  - extension nodes
    - branch node with 1 child is compressed
  - leaf nodes
    - node that doesnt have child
    - has **terminator**
- leaf nodes has **terminator** and extension nodes does not
- **terminator** is the **last byte of the path** and has value of **16** in dec or **0x10** in hex
- As we can see, it’s possible to the **path** has odd length but odd length is not friendly to machines. So we have to **convert all odd-length paths to even-length paths**.

> In summary, HP encoding goals are:
>
> - 1. Distinguish MPT **leaf** node and **extension** node from each other by **terminator**
> - 2. Convert the **path** to **even** length
